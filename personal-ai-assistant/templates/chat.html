{% extends "layout.html" %}

{% block title %}Chat | Chief of Staff AI{% endblock %}

{% block additional_styles %}
<style>
    .chat-messages {
        height: 500px;
        overflow-y: auto;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 1rem;
    }
    .message {
        margin-bottom: 1rem;
        padding: 1rem;
        border-radius: 10px;
        max-width: 80%;
        word-wrap: break-word;
    }
    .user-message {
        background-color: #4a6fdc;
        color: white;
        margin-left: auto;
    }
    .assistant-message {
        background-color: #e9ecef;
        color: #212529;
    }
    .message-input {
        display: flex;
        gap: 10px;
    }
    .message-input textarea {
        flex-grow: 1;
        border-radius: 10px;
        padding: 10px;
        border: 1px solid #ced4da;
        resize: none;
    }
    .typing-indicator {
        display: none;
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 10px;
        margin-bottom: 1rem;
        width: fit-content;
    }
    .typing-indicator span {
        display: inline-block;
        width: 8px;
        height: 8px;
        background-color: #6c757d;
        border-radius: 50%;
        animation: typing 1s infinite;
        margin-right: 5px;
    }
    .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
    }
    .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
    }
    @keyframes typing {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-5px);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="content-container">
    <div class="header">
        <h1>Chat with Claude</h1>
        <p class="mb-0">Your personal AI assistant powered by Claude</p>
    </div>
    
    <div class="chat-messages" id="chatMessages">
        <div class="message assistant-message">
            Hello! I'm your AI Chief of Staff. How can I help you today?
        </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
        <span></span>
        <span></span>
        <span></span>
        Claude is typing...
    </div>
    
    <div class="message-input">
        <textarea id="messageInput" rows="3" placeholder="Type your message here..."></textarea>
        <button id="sendButton" class="btn btn-primary">Send</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        
        // Function to add a message to the chat
        function addMessage(message, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'assistant-message');
            messageDiv.textContent = message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Function to send a message
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message === '') return;
            
            // Add user message to chat
            addMessage(message, true);
            messageInput.value = '';
            
            // Show typing indicator
            typingIndicator.style.display = 'block';
            
            // Send message to server
            fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message }),
            })
            .then(response => response.json())
            .then(data => {
                // Hide typing indicator
                typingIndicator.style.display = 'none';
                
                // Add assistant response to chat
                addMessage(data.response, false);
            })
            .catch(error => {
                console.error('Error:', error);
                typingIndicator.style.display = 'none';
                addMessage('Sorry, there was an error processing your request.', false);
            });
        }
        
        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        });
        
        // Focus on input when page loads
        messageInput.focus();
    });
</script>
{% endblock %}